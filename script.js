// ===== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò –î–ê–ù–ù–´–ï =====

// –î–∞–Ω–Ω—ã–µ —Ç—É—Ä–æ–≤
const tours = [
    {
        image: 'main-foto1/vodopad1.jpg',
        title: '–í–æ–¥–æ–ø–∞–¥—ã –∏ –¥–∂—É–Ω–≥–ª–∏',
        desc: '–ü—Ä–æ–≥—É–ª–∫–∞ –ø–æ –∂–∏–≤–æ–ø–∏—Å–Ω—ã–º –º–µ—Å—Ç–∞–º, –º–Ω–æ–≥–æ —Ä–∞–∑–Ω—ã—Ö –≤–æ–¥–æ–ø–∞–¥–æ–≤, –≤ —Å–∞–º–æ–º —Å–µ—Ä–¥—Ü–µ –æ—Å—Ç—Ä–æ–≤–∞ –≤ –¥–∏–∫–∏—Ö –¥–∂—É–Ω–≥–ª—è—Ö',
        detailedDesc: '–≠—Ç–æ—Ç —Ç—É—Ä –ø—Ä–æ–≤–µ–¥–µ—Ç –≤–∞—Å —á–µ—Ä–µ–∑ —Å–∞–º—ã–µ –∫—Ä–∞—Å–∏–≤—ã–µ –≤–æ–¥–æ–ø–∞–¥—ã –æ—Å—Ç—Ä–æ–≤–∞. –í—ã —É–≤–∏–¥–∏—Ç–µ —Å–∫—Ä—ã—Ç—ã–µ –ø—Ä–∏—Ä–æ–¥–Ω—ã–µ –±–∞—Å—Å–µ–π–Ω—ã, –∏—Å–∫—É–ø–∞–µ—Ç–µ—Å—å –≤ –∫—Ä–∏—Å—Ç–∞–ª—å–Ω–æ —á–∏—Å—Ç–æ–π –≤–æ–¥–µ –∏ –Ω–∞—Å–ª–∞–¥–∏—Ç–µ—Å—å –≤–∏–¥–∞–º–∏ –Ω–µ—Ç—Ä–æ–Ω—É—Ç–æ–π –ø—Ä–∏—Ä–æ–¥—ã.',
        price: '7000—Ä—É–±',
        duration: '6 —á–∞—Å–æ–≤',
        groupSize: '–¥–æ 8 —á–µ–ª–æ–≤–µ–∫',
        difficulty: '–°—Ä–µ–¥–Ω—è—è',
        gallery: ['vodopad5/v1.jpg', 'vodopad5/v2.jpg', 'vodopad5/v3.jpg', 'vodopad5/v4.jpg', 
            'vodopad5/v5.jpg','vodopad5/v6.jpg', 'vodopad5/v7.jpg', 'vodopad5/v8.jpg', 'vodopad5/v9.jpg', 
            'vodopad5/v10.jpg', 'vodopad5/v11.jpg', 'vodopad5/v12.jpg'],
         videoUrl: 'https://www.youtube.com/embed/–¢–í–û–ô_–ö–û–î_–í–ò–î–ï–û'
    },
    {
        image: 'main-foto1/Plag1.jpg', 
        title: '–†–∞–π—Å–∫–∏–π –ø–ª—è–∂',
        desc: '–í—ã –æ–∫—É–Ω–µ—Ç–µ—Å—å –≤ —Å–∞–º—É—é —á–∏—Å—Ç–µ–π—à—É—é –≤–æ–¥—É, –¥–∞–π–≤–∏–Ω–≥, –ø–æ—Å–º–æ—Ç—Ä –∫–æ—Ä–∞–ª–ª–æ–≤—ã—Ö —Ä—ã–±–æ–∫',
        detailedDesc: '–ò–¥–µ–∞–ª—å–Ω—ã–π —Ç—É—Ä –¥–ª—è –ª—é–±–∏—Ç–µ–ª–µ–π –ø–ª—è–∂–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞ –∏ –ø–æ–¥–≤–æ–¥–Ω–æ–≥–æ –º–∏—Ä–∞. –ú—ã –ø–æ—Å–µ—Ç–∏–º —Å–∞–º—ã–µ –∫—Ä–∞—Å–∏–≤—ã–µ –ø–ª—è–∂–∏ –æ—Å—Ç—Ä–æ–≤–∞ —Å –±–µ–ª—ã–º –ø–µ—Å–∫–æ–º –∏ –±–∏—Ä—é–∑–æ–≤–æ–π –≤–æ–¥–æ–π.',
        price: '8000—Ä—É–±',
        duration: '8 —á–∞—Å–æ–≤',
        groupSize: '–¥–æ 6 —á–µ–ª–æ–≤–µ–∫',
        difficulty: '–ù–∏–∑–∫–∞—è',
        gallery: ['raisrii-plaj4/r1.jpg', 'raisrii-plaj4/r2.jpg', 'raisrii-plaj4/r3.jpg', 'raisrii-plaj4/r4.jpg',
             'raisrii-plaj4/r5.jpg', 'raisrii-plaj4/r6.jpg', 'raisrii-plaj4/r7.jpg', 'raisrii-plaj4/r8.jpg', 
             'raisrii-plaj4/r9.jpg', 'raisrii-plaj4/r10.jpg', 'raisrii-plaj4/r11.jpg', 'raisrii-plaj4/r12.jpg', 'raisrii-plaj4/r13.jpg'],
        videoUrl: 'https://www.youtube.com/embed/–¢–í–û–ô_–ö–û–î_–í–ò–î–ï–û'
             
    },
    {
        image: 'main-foto1/gungli1.jpg',
        title: '–î–∂—É–Ω–≥–ª–∏', 
        desc: '–ü—Ä–æ–≥—É–ª–∫–∏ –ø–æ –¥–∏–∫–∏–º –¥–∂—É–Ω–≥–ª—è–º, –±—É–¥–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–∫—É–ø–∞—Ç—Å—è –≤ –∑–∞–≤–æ–¥—è—Ö –ø–æ–¥ –≤–æ–¥–æ–ø–∞–¥–æ–º',
        detailedDesc: '–≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –Ω–∞—Å—Ç–æ—è—â–∏—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–µ–π! –ú—ã –æ—Ç–ø—Ä–∞–≤–∏–º—Å—è –≤–≥–ª—É–±—å –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã—Ö –¥–∂—É–Ω–≥–ª–µ–π, –≥–¥–µ –≤–∞—Å –∂–¥—É—Ç –ø–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ –ø–æ–¥–≤–µ—Å–Ω—ã–µ –º–æ—Å—Ç—ã –∏ –∫—É–ø–∞–Ω–∏–µ –≤ –ø—Ä–∏—Ä–æ–¥–Ω—ã—Ö –±–∞—Å—Å–µ–π–Ω–∞—Ö.',
        price: '9000—Ä—É–±',
        duration: '5 —á–∞—Å–æ–≤',
        groupSize: '–¥–æ 10 —á–µ–ª–æ–≤–µ–∫',
        difficulty: '–í—ã—Å–æ–∫–∞—è',
        gallery: ['jungli3/j1.jpg', 'jungli3/j2.jpg', 'jungli3/j3.jpg', 'jungli3/j4.jpg', 'jungli3/j5.jpg', 'jungli3/j6.jpg',
             'jungli3/j7.jpg', 'jungli3/j8.jpg', 'jungli3/j9.jpg', 'jungli3/j10.jpg'],
         videoUrl: 'https://www.youtube.com/embed/–¢–í–û–ô_–ö–û–î_–í–ò–î–ï–û'
    },
    {
        image: 'main-foto1/diki1.jpg',
        title: '–î–∏–∫–∞—è –±—É—Ö—Ç–∞',
        desc: '–í —ç—Ç–æ–π –¥–∏–∫–æ–π –±—É—Ö—Ç–µ –≤—ã –ø–æ—á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å—è–±—è, —Å–ª–æ–≤–Ω–æ –≤—ã –Ω–∞ –Ω–µ –æ–±–∏—Ç–∞–µ–º–æ–º –æ—Å—Ç—Ä–æ–≤–µ',
        detailedDesc: '–£–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Ç—É—Ä –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ö–æ—á–µ—Ç –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–µ–±—è –Ω–∞—Å—Ç–æ—è—â–∏–º –†–æ–±–∏–Ω–∑–æ–Ω–æ–º –ö—Ä—É–∑–æ. –ú—ã –ø–æ—Å–µ—Ç–∏–º —Ç—Ä—É–¥–Ω–æ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –±—É—Ö—Ç—ã, –∫—É–¥–∞ –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –æ–±—ã—á–Ω—ã–µ —Ç—É—Ä–∏—Å—Ç—ã.',
        price: '9000—Ä—É–±',
        duration: '7 —á–∞—Å–æ–≤',
        groupSize: '–¥–æ 4 —á–µ–ª–æ–≤–µ–∫',
        difficulty: '–°—Ä–µ–¥–Ω—è—è',
        gallery: ['dikay-buxta2/db1.jpg', 'dikay-buxta2/db2.jpg', 'dikay-buxta2/db3.jpg', 'dikay-buxta2/db4.jpg', 'dikay-buxta2/db5.jpg',
             'dikay-buxta2/db6.jpg', 'dikay-buxta2/db7.jpg', 'dikay-buxta2/db8.jpg', 'dikay-buxta2/db9.jpg', 'dikay-buxta2/db10.jpg', 
             'dikay-buxta2/db11.jpg', 'dikay-buxta2/db12.jpg', 'dikay-buxta2/db13.jpg', 'dikay-buxta2/db14.jpg', 'dikay-buxta2/bd15.jpg'],
        videoUrl: 'https://www.youtube.com/embed/–¢–í–û–ô_–ö–û–î_–í–ò–î–ï–û'
    },
    {
        image: 'main-foto1/gungli1.jpg',
        title: '–ì–æ—Ä–Ω–æ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ', 
        desc: '–í–æ—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –Ω–∞ —Å–∞–º—ã–µ –∂–∏–≤–æ–ø–∏—Å–Ω—ã–µ –≤–µ—Ä—à–∏–Ω—ã –æ—Å—Ç—Ä–æ–≤–∞ —Å –æ–ø—ã—Ç–Ω—ã–º–∏ –≥–∏–¥–∞–º–∏',
        detailedDesc: '–î–ª—è –ª—é–±–∏—Ç–µ–ª–µ–π –≥–æ—Ä –∏ –ø–∞–Ω–æ—Ä–∞–º–Ω—ã—Ö –≤–∏–¥–æ–≤. –≠—Ç–æ—Ç —Ç—É—Ä –≤–∫–ª—é—á–∞–µ—Ç –≤–æ—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –Ω–∞ —Å–∞–º—ã–µ –≤—ã—Å–æ–∫–∏–µ —Ç–æ—á–∫–∏ –æ—Å—Ç—Ä–æ–≤–∞, –æ—Ç–∫—É–¥–∞ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–µ –≤–∏–¥—ã –Ω–∞ –æ–∫–µ–∞–Ω.',
        price: '11000—Ä—É–±',
        duration: '8 —á–∞—Å–æ–≤',
        groupSize: '–¥–æ 6 —á–µ–ª–æ–≤–µ–∫',
        difficulty: '–í—ã—Å–æ–∫–∞—è',
        gallery: ['jungli3/j1.jpg', 'jungli3/j2.jpg', 'jungli3/j3.jpg'],
        videoUrl: 'https://www.youtube.com/embed/–¢–í–û–ô_–ö–û–î_–í–ò–î–ï–û'
    },
    {
        image: 'main-foto1/diki1.jpg',
        title: '–ù–æ—á–Ω–æ–µ —Å–∞—Ñ–∞—Ä–∏',
        desc: '–£–Ω–∏–∫–∞–ª—å–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–≤–∏–¥–µ—Ç—å –Ω–æ—á–Ω—É—é –∂–∏–∑–Ω—å –¥–∂—É–Ω–≥–ª–µ–π –∏ —ç–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö',
        detailedDesc: '–ú–∞–≥–∏—á–µ—Å–∫–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ –Ω–æ—á–Ω—ã–µ –¥–∂—É–Ω–≥–ª–∏! –° –ø–æ–º–æ—â—å—é —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –º—ã –±—É–¥–µ–º –Ω–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –Ω–æ—á–Ω—ã–º–∏ –∂–∏–≤–æ—Ç–Ω—ã–º–∏: –ª–µ–º—É—Ä–∞–º–∏, –ª–µ—Ç—É—á–∏–º–∏ –º—ã—à–∞–º–∏ –∏ –Ω–æ—á–Ω—ã–º–∏ –ø—Ç–∏—Ü–∞–º–∏.',
        price: '8500—Ä—É–±',
        duration: '4 —á–∞—Å–∞',
        groupSize: '–¥–æ 8 —á–µ–ª–æ–≤–µ–∫',
        difficulty: '–ù–∏–∑–∫–∞—è',
        gallery: ['dikay-buxta2/db1.jpg', 'dikay-buxta2/db2.jpg', 'dikay-buxta2/db3.jpg'],
        videoUrl: 'https://www.youtube.com/embed/–¢–í–û–ô_–ö–û–î_–í–ò–î–ï–û'
    }
];

// –î–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–µ–π
// –ù–ê–ô–î–ò –≠–¢–£ –ß–ê–°–¢–¨ –í script.js –ò –ó–ê–ú–ï–ù–ò –í–°–Æ (—Å—Ç—Ä–æ–∫–∏ –ø—Ä–∏–º–µ—Ä–Ω–æ 406-441):

// –î–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–µ–π
const newsData = [
    {
        id: 1,
        title: "–û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ—Å—å –Ω–∞ —Ä–∞–π—Å–∫–∏–π –ø–ª—è–∂ '–†–∞–π—Å–∫–∏–π –ø–ª—è–∂'",
        excerpt: "–ú—ã –Ω–∞—à–ª–∏ —Å–∞–º—ã–π –∫—Ä–∞—Å–∏–≤—ã–π –ø–ª—è–∂ –æ—Å—Ç—Ä–æ–≤–∞ —Å –±–µ–ª—ã–º –ø–µ—Å–∫–æ–º –∏ –∫—Ä–∏—Å—Ç–∞–ª—å–Ω–æ —á–∏—Å—Ç–æ–π –≤–æ–¥–æ–π.",
        date: "2025-01-15",
        category: "—Å–æ–±—ã—Ç–∏—è",
        image: "news-photos/n1.jpg",
        views: 1247,
        tags: ["–≥–æ—Ä—ã", "–Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç", "–ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è"],
        featured: true
    },
    {
        id: 2,
        title: "–°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –∞–∫—Ü–∏—è –¥–ª—è —Ä–∞–Ω–Ω–µ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è",
        excerpt: "–ó–∞–±—Ä–æ–Ω–∏—Ä—É–π—Ç–µ –ª—é–±–æ–π —Ç—É—Ä –¥–æ 1 —Ñ–µ–≤—Ä–∞–ª—è –∏ –ø–æ–ª—É—á–∏—Ç–µ —Å–∫–∏–¥–∫—É 15% –Ω–∞ –≤—Å–µ —ç–∫—Å–∫—É—Ä—Å–∏–∏! –£—Å–ø–µ–π—Ç–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤—ã–≥–æ–¥–Ω—ã–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º.",
        date: "2025-01-10",
        category: "–∞–∫—Ü–∏–∏",
        image: "news-photos/n2.jpg",
        views: 892,
        tags: ["–∞–∫—Ü–∏—è", "—Å–∫–∏–¥–∫–∞", "–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ"],
        featured: false
    },
    {
        id: 3,
        title: "–ö–∞–∫ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ –ø–æ—Ö–æ–¥—É –≤ –¥–∂—É–Ω–≥–ª–∏",
        excerpt: "–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤: —á—Ç–æ –≤–∑—è—Ç—å —Å —Å–æ–±–æ–π, –∫–∞–∫—É—é –æ–±—É–≤—å –≤—ã–±—Ä–∞—Ç—å –∏ –∫–∞–∫ –≤–µ—Å—Ç–∏ —Å–µ–±—è –≤ –¥–∏–∫–æ–π –ø—Ä–∏—Ä–æ–¥–µ.",
        date: "2025-01-05",
        category: "—Å–æ–≤–µ—Ç—ã",
        image: "news-photos/n3.jpg",
        views: 1563,
        tags: ["—Å–æ–≤–µ—Ç—ã", "–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞", "–¥–∂—É–Ω–≥–ª–∏"],
        featured: false
    },
    {
        id: 4,
        title: "–î–∂—É–Ω–≥–ª–∏ + –í–æ–¥–æ–ø–∞–¥—ã + –î–∏–∫–∞—è –±—É—Ö—Ç–∞",
        excerpt: "–ù–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –Ω–∞—Å—Ç–æ—è—â–∏—Ö –∏—Å–∫–∞—Ç–µ–ª–µ–π –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π!" + 
        "2 –¥–Ω—è –≤ –¥–∏–∫–æ–π –ø—Ä–∏—Ä–æ–¥–µ: –ø–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ –¥–∂—É–Ω–≥–ª–∏, –Ω–æ—á—ë–≤–∫–∞ —É –≤–æ–¥–æ–ø–∞–¥–∞ –∏ –æ—Ç–¥—ã—Ö –≤ –∑–∞–ø–æ–≤–µ–¥–Ω–æ–π –±—É—Ö—Ç–µ.",
        date: "2025-01-03",
        category: "–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è",
        image: "news-photos/n5.jpg",
        views: 734,
        tags: ["–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ", "—Å–∞—Ñ–∞—Ä–∏", "–Ω–æ—á—å"],
        featured: false
    },
    {
        id: 5,
        title: "–°–µ–∑–æ–Ω –¥–æ–∂–¥–µ–π: –ª—É—á—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –≤–æ–¥–æ–ø–∞–¥–æ–≤",
        excerpt: "–£–∑–Ω–∞–π—Ç–µ, –ø–æ—á–µ–º—É —Å–µ–∑–æ–Ω –¥–æ–∂–¥–µ–π - –∏–¥–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –ø–æ—Å–µ—â–µ–Ω–∏—è –≤–æ–¥–æ–ø–∞–¥–æ–≤ –∏ –∫–∞–∫–∏–µ –∏–∑ –Ω–∏—Ö —Å–∞–º—ã–µ –≤–ø–µ—á–∞—Ç–ª—è—é—â–∏–µ –≤ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥.",
        date: "2024-12-28",
        category: "—Å–æ–≤–µ—Ç—ã",
        image: "news-photos/n6.jpg",
        views: 921,
        tags: ["–≤–æ–¥–æ–ø–∞–¥—ã", "—Å–µ–∑–æ–Ω", "—Å–æ–≤–µ—Ç—ã"],
        featured: false
    },
    {
        id: 6,
        title: "–ù–æ–≤—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Å —Ç—É—Ä–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –≥–∞–ª–µ—Ä–µ–µ",
        excerpt: "–û–±–Ω–æ–≤–∏–ª–∏ –≥–∞–ª–µ—Ä–µ—é —Å–≤–µ–∂–∏–º–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ç—É—Ä–æ–≤. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ª—É—á—à–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ–∏ –±—É–¥—É—â–∏–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è!",
        date: "2024-12-25",
        category: "–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è",
        image: "news-photos/n7.jpg",
        views: 645,
        tags: ["—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏", "–≥–∞–ª–µ—Ä–µ—è", "–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ"],
        featured: false
    }
];

// ===== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï =====
let currentTourIndex = 0;
let currentImageIndex = 0;
let fullscreenCurrentIndex = 0;

// ===== –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô =====
function initImageOptimization() {
    // –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç–∏–Ω–æ–∫
    const lazyImages = document.querySelectorAll('img[loading="lazy"]');
    
    const imageObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                img.src = img.dataset.src || img.src;
                img.classList.add('loaded');
                imageObserver.unobserve(img);
            }
        });
    });

    lazyImages.forEach(img => {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π src –≤ data-src
        if (!img.dataset.src) {
            img.dataset.src = img.src;
            img.src = '';
            img.classList.add('skeleton');
        }
        imageObserver.observe(img);
    });
}

// ===== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –¢–£–†–û–í –ò –ì–ê–õ–ï–†–ï–ò =====

/**
 * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç—É—Ä–æ–≤ –¥–ª—è —Å–µ–∫—Ü–∏–∏ "–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ"
 */
function generateTours() {
    const grid = document.querySelector('.features-grid');
    if (!grid) return;
    
    grid.innerHTML = tours.map((tour, index) => `
        <div class="feature-card">
            <div class="card-image" style="background-image: url('${tour.image}')" onclick="openGallery(${index})">
                <button class="gallery-toggle" onclick="event.stopPropagation(); openGallery(${index})">‚ûû</button>
            </div>
            <div class="card-content">
                <h3>${tour.title}</h3>
                <p>${tour.desc}</p>
                <p class="price">—Ü–µ–Ω–∞ ${tour.price}</p>
            </div>
        </div>
    `).join('');
}

/**
 * –û—Ç–∫—Ä—ã—Ç–∏–µ –≥–∞–ª–µ—Ä–µ–∏ —Ç—É—Ä–∞
 */
function openGallery(tourIndex) {
    try {
        currentTourIndex = tourIndex;
        currentImageIndex = 0;
        const tour = tours[tourIndex];
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç—É—Ä–µ
        document.getElementById('galleryTitle').textContent = tour.title;
        document.getElementById('galleryDescription').textContent = tour.detailedDesc;
        document.getElementById('tourDuration').textContent = tour.duration;
        document.getElementById('tourGroupSize').textContent = tour.groupSize;
        document.getElementById('tourDifficulty').textContent = tour.difficulty;
        document.getElementById('galleryPrice').textContent = tour.price;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        document.getElementById('galleryModal').style.display = 'flex';
        document.body.style.overflow = 'hidden';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤–æ–µ —Ñ–æ—Ç–æ –∏ —Å–æ–∑–¥–∞–µ–º –º–∏–Ω–∏–∞—Ç—é—Ä—ã
        showImage();
        createThumbnails();
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        document.getElementById('bookTourBtn').onclick = function() {
            bookTour(currentTourIndex);
        };
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≥–∞–ª–µ—Ä–µ–∏:', error);
        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≥–∞–ª–µ—Ä–µ–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
}

/**
 * –ü–æ–∫–∞–∑ —Ç–µ–∫—É—â–µ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –≥–∞–ª–µ—Ä–µ–µ
 */
function showImage() {
    try {
        const tour = tours[currentTourIndex];
        const imageElement = document.getElementById('galleryImage');
        
        if (tour.gallery && tour.gallery[currentImageIndex]) {
            imageElement.src = tour.gallery[currentImageIndex];
            imageElement.alt = `${tour.title} - —Ñ–æ—Ç–æ ${currentImageIndex + 1}`;
        } else {
            imageElement.src = tour.image;
            imageElement.alt = tour.title;
        }
        
        updateActiveThumbnail();
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', error);
    }
}
/**
 * –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–Ω–∏–∞—Ç—é—Ä –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏
 */
function createThumbnails() {
    try {
        const container = document.getElementById('galleryThumbnails');
        const tour = tours[currentTourIndex];
        
        container.innerHTML = '';
        
        const images = tour.gallery && tour.gallery.length > 0 ? tour.gallery : [tour.image];
        
        images.forEach((image, index) => {
            const thumb = document.createElement('img');
            thumb.src = image;
            thumb.alt = `–§–æ—Ç–æ —Ç—É—Ä–∞ ${tour.title} - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${index + 1}`;
            thumb.loading = "lazy";
            thumb.className = 'thumbnail';
            if (index === currentImageIndex) {
                thumb.classList.add('active');
            }
            
            thumb.addEventListener('click', () => {
                currentImageIndex = index;
                showImage();
            });
            
            container.appendChild(thumb);
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∏–∫ –Ω–∞ –≥–ª–∞–≤–Ω–æ–µ —Ñ–æ—Ç–æ –¥–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        const mainImage = document.getElementById('galleryImage');
        mainImage.onclick = function() {
            const tour = tours[currentTourIndex];
            const images = tour.gallery && tour.gallery.length > 0 ? tour.gallery : [tour.image];
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ gallery-viewer.js
            if (typeof openPhotoFullscreen === 'function') {
                openPhotoFullscreen(mainImage, images, currentImageIndex);
            }
        };
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–∏–Ω–∏–∞—Ç—é—Ä:', error);
    }
}

/**
 * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –º–∏–Ω–∏–∞—Ç—é—Ä—ã
 */
function updateActiveThumbnail() {
    document.querySelectorAll('.thumbnail').forEach((thumb, index) => {
        thumb.classList.toggle('active', index === currentImageIndex);
    });
}

/**
 * –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
 */
function nextImage() {
    const tour = tours[currentTourIndex];
    const images = tour.gallery && tour.gallery.length > 0 ? tour.gallery : [tour.image];
    currentImageIndex = (currentImageIndex + 1) % images.length;
    showImage();
}

/**
 * –ü–µ—Ä–µ—Ö–æ–¥ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
 */
function prevImage() {
    const tour = tours[currentTourIndex];
    const images = tour.gallery && tour.gallery.length > 0 ? tour.gallery : [tour.image];
    currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
    showImage();
}

/**
 * –ó–∞–∫—Ä—ã—Ç–∏–µ –≥–∞–ª–µ—Ä–µ–∏
 */
function closeGallery() {
    document.getElementById('galleryModal').style.display = 'none';
    document.body.style.overflow = 'auto';
}

// ===== –§–£–ù–ö–¶–ò–ò –ë–†–û–ù–ò–†–û–í–ê–ù–ò–Ø =====

/**
 * –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—É—Ä–∞ —á–µ—Ä–µ–∑ WhatsApp
 */
function bookTour(tourIndex) {
    try {
        const tour = tours[tourIndex];
        const phoneNumber = '79531776472';
        const message = `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –•–æ—á—É –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ç—É—Ä: "${tour.title}". –¶–µ–Ω–∞: ${tour.price}. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å–æ –º–Ω–æ–π –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π.`;
        
        // –û—Ç–∫—Ä—ã–≤–∞–µ–º WhatsApp —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º
        const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
        window.open(whatsappUrl, '_blank');
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≥–∞–ª–µ—Ä–µ—é –µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞
        closeGallery();
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ç—É—Ä–∞:', error);
        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
}

// ===== –§–£–ù–ö–¶–ò–ò –°–õ–ê–ô–î–ï–†–ê =====

/**
 * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–∞–π–¥–µ—Ä–∞ —Ç—É—Ä–æ–≤
 */
function initSlider() {
    const track = document.querySelector('.slider-track');
    if (!track) return;
    
    try {
        // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è —Å–ª–∞–π–¥–µ—Ä–∞
        track.innerHTML = tours.map((tour, index) => `
            <div class="feature-card" style="min-width: calc(100% / 3); padding: 0 10px;">
                <div class="card-image" style="background-image: url('${tour.image}')" onclick="openGallery(${index})">
                    <button class="gallery-toggle" onclick="event.stopPropagation(); openGallery(${index})">‚ûû</button>
                </div>
                <div class="card-content">
                    <h3>${tour.title}</h3>
                    <p>${tour.desc}</p>
                    <p class="price">—Ü–µ–Ω–∞ ${tour.price}</p>
                </div>
            </div>
        `).join('');

        const cards = document.querySelectorAll('.slider-track .feature-card');
        const dotsContainer = document.querySelector('.slider-dots');
        const prevBtn = document.querySelector('.prev-btn');
        const nextBtn = document.querySelector('.next-btn');
        
        if (cards.length === 0) return;

        let currentSlide = 0;
        const cardsPerSlide = 3;
        const totalSlides = Math.ceil(cards.length / cardsPerSlide);
        
        // –°–æ–∑–¥–∞–µ–º —Ç–æ—á–∫–∏ –¥–ª—è —Å–ª–∞–π–¥–µ—Ä–∞
        if (dotsContainer) {
            dotsContainer.innerHTML = '';
            for (let i = 0; i < totalSlides; i++) {
                const dot = document.createElement('div');
                dot.className = 'dot';
                if (i === 0) dot.classList.add('active');
                dot.addEventListener('click', () => goToSlide(i));
                dotsContainer.appendChild(dot);
            }
        }
        
        function updateSlider() {
            const slideWidth = 100 / cardsPerSlide;
            track.style.transform = `translateX(-${currentSlide * slideWidth}%)`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é —Ç–æ—á–∫—É
            document.querySelectorAll('.dot').forEach((dot, index) => {
                dot.classList.toggle('active', index === currentSlide);
            });
        }
        
        function goToSlide(slideIndex) {
            currentSlide = slideIndex;
            updateSlider();
        }
        
        function nextSlide() {
            currentSlide = (currentSlide + 1) % totalSlides;
            updateSlider();
        }
        
        function prevSlide() {
            currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
            updateSlider();
        }
        
        if (prevBtn) prevBtn.addEventListener('click', prevSlide);
        if (nextBtn) nextBtn.addEventListener('click', nextSlide);
        
        // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ —Å–ª–∞–π–¥–µ—Ä–∞
        let slideInterval = setInterval(nextSlide, 5000);
        
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫—É –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
        track.addEventListener('mouseenter', () => clearInterval(slideInterval));
        track.addEventListener('mouseleave', () => {
            slideInterval = setInterval(nextSlide, 5000);
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–ª–∞–π–¥–µ—Ä
        updateSlider();
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–ª–∞–π–¥–µ—Ä–∞:', error);
    }
}

// ===== –§–£–ù–ö–¶–ò–ò –°–ï–ö–¶–ò–ò "–û –ù–ê–°" =====

/**
 * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ–∫—Ü–∏–∏ "–û –Ω–∞—Å"
 */
function initAboutSection() {
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabPanes = document.querySelectorAll('.tab-pane');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –∏ –ø–∞–Ω–µ–ª–µ–π
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabPanes.forEach(pane => pane.classList.remove('active'));
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–π –∫–Ω–æ–ø–∫–µ –∏ –ø–∞–Ω–µ–ª–∏
            button.classList.add('active');
            const tabId = button.getAttribute('data-tab');
            document.getElementById(tabId).classList.add('active');
        });
    });
    
    // –ê–Ω–∏–º–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤
    function animateCounters() {
        const counters = document.querySelectorAll('.stat-number');
        const speed = 200;
        
        counters.forEach(counter => {
            const target = +counter.getAttribute('data-target');
            const count = +counter.innerText;
            const increment = target / speed;
            
            if (count < target) {
                counter.innerText = Math.ceil(count + increment);
                setTimeout(() => animateCounters(), 1);
            } else {
                counter.innerText = target;
            }
        });
    }
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ –∫ —Å–µ–∫—Ü–∏–∏
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                animateCounters();
                observer.unobserve(entry.target);
            }
        });
    });
    
    const aboutSection = document.getElementById('about');
    if (aboutSection) {
        observer.observe(aboutSection);
    }
}

// ===== –§–£–ù–ö–¶–ò–ò –°–ï–ö–¶–ò–ò –ù–û–í–û–°–¢–ï–ô =====

/**
 * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ–∫—Ü–∏–∏ –Ω–æ–≤–æ—Å—Ç–µ–π
 */
function initNewsSection() {
    let currentFilter = 'all';
    let visibleNews = 3;
    
    // –†–µ–Ω–¥–µ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π
    function renderNews(filter = 'all', count = visibleNews) {
        try {
            const container = document.getElementById('newsContainer');
            if (!container) return;
            
            const filteredNews = filter === 'all' 
                ? newsData 
                : newsData.filter(news => news.category === filter);
            
            const newsToShow = filteredNews.slice(0, count);
            
            container.innerHTML = newsToShow.map(news => `
                <div class="news-card" data-category="${news.category}">
                    <div class="news-image">
                        <img src="${news.image}" alt="${news.title}" loading="lazy" onerror="this.src='placeholder.jpg'">
                        <span class="news-category">${news.category}</span>
                    </div>
                    <div class="news-content">
                        <div class="news-meta">
                            <span class="news-date">${formatDate(news.date)}</span>
                            <span class="news-views">üëÅÔ∏è ${formatViews(news.views)}</span>
                        </div>
                        <h3>${news.title}</h3>
                        <p class="news-excerpt">${news.excerpt}</p>
                        <div class="news-tags">
                            ${news.tags.map(tag => `<span class="tag">#${tag}</span>`).join('')}
                        </div>
                        <a href="news/news-${news.id}.html" class="read-more">–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ ‚Üí</a>

                    </div>
                </div>
            `).join('');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ–∫–∞–∑–∞—Ç—å –µ—â–µ"
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            if (loadMoreBtn) {
                loadMoreBtn.style.display = count < filteredNews.length ? 'block' : 'none';
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ –Ω–æ–≤–æ—Å—Ç–µ–π:', error);
        }
    }
    
    /**
     * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
     */
    function formatDate(dateString) {
        try {
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            return new Date(dateString).toLocaleDateString('ru-RU', options);
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã:', error);
            return dateString;
        }
    }
    
    /**
     * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
     */
    function formatViews(views) {
        if (views >= 1000) {
            return (views / 1000).toFixed(1) + 'K';
        }
        return views;
    }
    
    /**
     * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–æ–≤–æ—Å—Ç–µ–π
     */
    function setupFilters() {
        const filterButtons = document.querySelectorAll('.filter-btn');
        
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
                filterButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä
                currentFilter = this.getAttribute('data-filter');
                visibleNews = 3;
                renderNews(currentFilter, visibleNews);
            });
        });
    }
    
    /**
     * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ü–æ–∫–∞–∑–∞—Ç—å –µ—â–µ"
     */
    function setupLoadMore() {
        const loadMoreBtn = document.getElementById('loadMoreBtn');
        if (loadMoreBtn) {
            loadMoreBtn.addEventListener('click', function() {
                visibleNews += 3;
                renderNews(currentFilter, visibleNews);
            });
        }
    }
    
    /**
     * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –Ω–æ–≤–æ—Å—Ç–∏
     */
    function setupSubscription() {
        const subscribeBtn = document.getElementById('subscribeNewsBtn');
        const emailInput = document.getElementById('newsEmail');
        
        if (subscribeBtn && emailInput) {
            subscribeBtn.addEventListener('click', function(e) {
                e.preventDefault();
                
                const email = emailInput.value.trim();
                const errors = validateEmail(email);
                
                if (errors.length === 0) {
                    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                    showNotification('–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É! –ú—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ confirmation email.', 'success');
                    emailInput.value = '';
                    emailInput.classList.remove('error');
                } else {
                    showNotification(errors[0], 'error');
                    emailInput.classList.add('error');
                }
            });
        }
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        if (emailInput) {
            emailInput.addEventListener('input', function() {
                const email = this.value.trim();
                const errors = validateEmail(email);
                
                if (errors.length === 0) {
                    this.classList.remove('error');
                    this.classList.add('success');
                } else {
                    this.classList.remove('success');
                    this.classList.add('error');
                }
            });
        }
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    renderNews();
    setupFilters();
    setupLoadMore();
    setupSubscription();
}

// ===== –§–£–ù–ö–¶–ò–ò –í–ê–õ–ò–î–ê–¶–ò–ò =====

/**
 * –í–∞–ª–∏–¥–∞—Ü–∏—è email
 */
function validateEmail(email) {
    const errors = [];
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    
    if (!email) {
        errors.push('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ email –∞–¥—Ä–µ—Å.');
    } else if (!re.test(email)) {
        errors.push('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å.');
    }
    
    return errors;
}

/**
 * –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
 */
function showNotification(message, type = 'info') {
    // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 5px;
        color: white;
        z-index: 10000;
        font-weight: bold;
        background: ${type === 'error' ? '#e74c3c' : type === 'success' ? '#27ae60' : '#3498db'};
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        transition: transform 0.3s ease;
    `;
    
    document.body.appendChild(notification);
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 5000);
}

// ===== –§–£–ù–ö–¶–ò–ò –ü–û–ì–û–î–´ =====

class WeatherWidget {
    constructor() {
        this.apiKey = '';
        this.city = 'Saint Petersburg';
        this.units = 'metric';
        this.lang = 'ru';
    }
    
    async init() {
        try {
            await this.getCurrentWeather();
            await this.getForecast();
            this.setupRefresh();
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–≥–æ–¥–Ω–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞:', error);
            this.showError();
        }
    }
    
    async getCurrentWeather() {
        try {
            const response = await fetch(
                `https://api.openweathermap.org/data/2.5/weather?q=${this.city}&units=${this.units}&lang=${this.lang}&appid=${this.apiKey}`
            );
            
            if (!response.ok) throw new Error('Weather data not available');
            
            const data = await response.json();
            this.updateCurrentWeather(data);
            
        } catch (error) {
            console.error('Error fetching weather:', error);
            this.showError();
        }
    }
    
    async getForecast() {
        try {
            const response = await fetch(
                `https://api.openweathermap.org/data/2.5/forecast?q=${this.city}&units=${this.units}&lang=${this.lang}&appid=${this.apiKey}`
            );
            
            if (!response.ok) throw new Error('Forecast data not available');
            
            const data = await response.json();
            this.updateForecast(data);
            
        } catch (error) {
            console.error('Error fetching forecast:', error);
        }
    }
    
    updateCurrentWeather(data) {
        try {
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            document.getElementById('weatherCity').textContent = data.name;
            document.getElementById('weatherTemp').textContent = Math.round(data.main.temp);
            document.getElementById('weatherDescription').textContent = data.weather[0].description;
            document.getElementById('weatherFeelsLike').textContent = Math.round(data.main.feels_like) + '¬∞C';
            document.getElementById('weatherHumidity').textContent = data.main.humidity + '%';
            document.getElementById('weatherWind').textContent = data.wind.speed + ' –º/—Å';
            document.getElementById('weatherPressure').textContent = data.main.pressure + ' hPa';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É
            const iconCode = data.weather[0].icon;
            const weatherIcon = document.getElementById('weatherIcon');
            weatherIcon.src = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
            weatherIcon.alt = data.weather[0].description;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è
            document.getElementById('weatherUpdateTime').textContent = this.formatTime(new Date());
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ:', error);
            this.showError();
        }
    }
    
    updateForecast(data) {
        try {
            const forecastContainer = document.getElementById('weatherForecast');
            const dailyForecasts = this.getDailyForecasts(data.list);
            
            forecastContainer.innerHTML = dailyForecasts.map(day => `
                <div class="forecast-day">
                    <div class="forecast-date">${this.formatDate(day.date)}</div>
                    <div class="forecast-icon">
                        <img src="https://openweathermap.org/img/wn/${day.icon}@2x.png" alt="${day.description}">
                    </div>
                    <div class="forecast-temp">${Math.round(day.temp)}¬∞C</div>
                    <div class="forecast-desc">${day.description}</div>
                </div>
            `).join('');
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–≥–Ω–æ–∑–∞ –ø–æ–≥–æ–¥—ã:', error);
        }
    }
    
    getDailyForecasts(forecastList) {
        try {
            // –ë–µ—Ä–µ–º –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 12:00 –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è
            const dailyForecasts = [];
            const processedDays = new Set();
            
            forecastList.forEach(item => {
                const date = new Date(item.dt * 1000);
                const dayKey = date.toDateString();
                
                // –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø—Ä–æ–≥–Ω–æ–∑ –≤ –¥–µ–Ω—å (–≤ 12:00)
                if (!processedDays.has(dayKey) && date.getHours() === 12) {
                    dailyForecasts.push({
                        date: date,
                        temp: item.main.temp,
                        icon: item.weather[0].icon,
                        description: item.weather[0].description
                    });
                    processedDays.add(dayKey);
                }
            });
            
            return dailyForecasts.slice(0, 5); // –ë–µ—Ä–µ–º 5 –¥–Ω–µ–π
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∞:', error);
            return [];
        }
    }
    
    formatTime(date) {
        try {
            return date.toLocaleTimeString('ru-RU', {
                hour: '2-digit',
                minute: '2-digit'
            });
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏:', error);
            return '--:--';
        }
    }
    
    formatDate(date) {
        try {
            return date.toLocaleDateString('ru-RU', {
                weekday: 'short',
                day: 'numeric',
                month: 'short'
            });
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã:', error);
            return '--';
        }
    }
    
    setupRefresh() {
        const refreshBtn = document.getElementById('refreshWeather');
        if (refreshBtn) {
            refreshBtn.addEventListener('click', () => {
                this.getCurrentWeather();
                this.getForecast();
            });
        }
    }
    
    showError() {
        try {
            const elements = [
                'weatherTemp', 'weatherDescription', 'weatherFeelsLike', 
                'weatherHumidity', 'weatherWind', 'weatherPressure'
            ];
            
            elements.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.textContent = '--';
            });
            
            const weatherIcon = document.getElementById('weatherIcon');
            if (weatherIcon) {
                weatherIcon.alt = '–î–∞–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã';
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ –ø–æ–≥–æ–¥—ã:', error);
        }
    }
}

// ===== –§–£–ù–ö–¶–ò–ò –ù–ê–í–ò–ì–ê–¶–ò–ò =====

/**
 * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –º–µ–Ω—é –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
 */
function updateActiveNav() {
    const sections = document.querySelectorAll('section');
    const navLinks = document.querySelectorAll('.nav-link');
    
    let currentSection = '';
    
    sections.forEach(section => {
        const sectionTop = section.offsetTop - 100;
        const sectionHeight = section.clientHeight;
        if (window.scrollY >= sectionTop && window.scrollY < sectionTop + sectionHeight) {
            currentSection = section.getAttribute('id');
        }
    });
    
    navLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === `#${currentSection}`) {
            link.classList.add('active');
        }
    });
}

/**
 * –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Å–µ–∫—Ü–∏—è–º
 */
function setupSmoothScroll() {
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
}

// ===== –§–£–ù–ö–¶–ò–ò –ö–ê–†–¢–´ =====

/**
 * –ö–ª–∞—Å—Å –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞ –∫–∞—Ä—Ç—ã
 */
class YandexMapWidget {
    constructor() {
        this.map = null;
        this.marker = null;
        this.location = [59.950971, 30.315107];
        this.isSatellite = false;
        this.trafficEnabled = false;
    }
    
    init() {
        this.showFallbackMap();
    }
    
    showFallbackMap() {
        // Fallback - –ø—Ä–æ—Å—Ç–∞—è –∫–∞—Ä—Ç–∞ —á–µ—Ä–µ–∑ iframe
        const mapContainer = document.getElementById('yandex-map');
        if (mapContainer) {
            mapContainer.innerHTML = `
                <iframe 
                    src="https://yandex.ru/map-widget/v1/?ll=37.617494%2C55.755826&z=15&pt=37.617494,55.755826,comma" 
                    width="100%" 
                    height="400" 
                    style="border:0; border-radius: 15px;" 
                    allowfullscreen="true">
                </iframe>
            `;
        }
    }
}

// ===== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ö–ê–†–¢–´ =====

/**
 * –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–ø—É—Ç–Ω–∏–∫–æ–≤–æ–≥–æ –≤–∏–¥–∞
 */
function setupMapControls() {
    const satelliteBtn = document.getElementById('satelliteView');
    const fullscreenBtn = document.getElementById('fullscreenMap');
    
    if (satelliteBtn) {
        satelliteBtn.addEventListener('click', function() {
            this.classList.toggle('active');
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∫–æ–¥ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å–ø—É—Ç–Ω–∏–∫–æ–≤–æ–≥–æ –≤–∏–¥–∞
            const mapFrame = document.querySelector('#yandex-map iframe');
            if (mapFrame) {
                const currentSrc = mapFrame.src;
                if (this.classList.contains('active')) {
                    mapFrame.src = currentSrc.replace('map', 'satellite');
                } else {
                    mapFrame.src = currentSrc.replace('satellite', 'map');
                }
            }
        });
    }
    
    if (fullscreenBtn) {
        fullscreenBtn.addEventListener('click', function() {
            this.classList.toggle('active');
            const mapContainer = document.getElementById('yandex-map');
            if (mapContainer.requestFullscreen) {
                mapContainer.requestFullscreen();
            } else if (mapContainer.webkitRequestFullscreen) {
                mapContainer.webkitRequestFullscreen();
            } else if (mapContainer.msRequestFullscreen) {
                mapContainer.msRequestFullscreen();
            }
        });
    }
}

// ===== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =====

/**
 * –û—Ç–∫—Ä—ã—Ç–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ø–Ω–¥–µ–∫—Å
 */
function openYandexNavigation() {
    try {
        const coordinates = [59.950971, 30.315107].join(',');
        const url = `https://yandex.ru/maps/?rtext=~${coordinates}&rtt=auto`;
        window.open(url, '_blank');
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏:', error);
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
}

/**
 * –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
 */
function copyPhone() {
    try {
        const phone = '+79531776472';
        navigator.clipboard.writeText(phone).then(() => {
            showNotification('–¢–µ–ª–µ—Ñ–æ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω: ' + phone, 'success');
        }).catch(() => {
            // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
            const textArea = document.createElement('textarea');
            textArea.value = phone;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showNotification('–¢–µ–ª–µ—Ñ–æ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω: ' + phone, 'success');
        });
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞:', error);
        showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω', 'error');
    }
}

// ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï –°–¢–†–ê–ù–ò–¶–´ =====

document.addEventListener('DOMContentLoaded', function() {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
    generateTours();
    initSlider();
    initAboutSection();
    initNewsSection();
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–≥–æ–¥–Ω–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞
    const weatherWidget = new WeatherWidget();
    weatherWidget.init();
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
    const yandexMapWidget = new YandexMapWidget();
    yandexMapWidget.init();
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ–π
    setupMapControls();
    
    // –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
    document.querySelector('.menu-toggle').addEventListener('click', function() {
        document.querySelector('.nav-links').classList.toggle('active');
    });
    
    // –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–æ–±—Ä–∞—Ç—å —Ç—É—Ä" –≤ –≥–µ—Ä–æ–µ
    document.getElementById('findTourBtn').addEventListener('click', function() {
        document.getElementById('popular').scrollIntoView({ 
            behavior: 'smooth',
            block: 'start'
        });
    });
    
    // –ö–Ω–æ–ø–∫–∞ "–ó–∞–∫–∞–∑–∞—Ç—å –∑–≤–æ–Ω–æ–∫"
    document.querySelector('.call-btn').addEventListener('click', function() {
        const phoneNumber = '79531776472';
        window.open(`tel:${phoneNumber}`);
    });
    
    // –ì–∞–ª–µ—Ä–µ—è —Å–æ–±—ã—Ç–∏—è
    document.querySelector('.close-gallery').addEventListener('click', closeGallery);
    document.getElementById('galleryModal').addEventListener('click', function(e) {
        if (e.target === this) closeGallery();
    });
    document.querySelector('.gallery-nav.next').addEventListener('click', nextImage);
    document.querySelector('.gallery-nav.prev').addEventListener('click', prevImage);
    
    // –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫–ª–∞–≤–∏—à–∞–º–∏
    document.addEventListener('keydown', function(e) {
        if (document.getElementById('galleryModal').style.display === 'flex') {
            if (e.key === 'ArrowRight') nextImage();
            if (e.key === 'ArrowLeft') prevImage();
            if (e.key === 'Escape') closeGallery();
        }
    });
    
    // –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞
    setupSmoothScroll();
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
    window.addEventListener('scroll', updateActiveNav);
});
